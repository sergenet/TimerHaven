<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TimerHaven: World Clock, Timers, Productivity Tools & More</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TimerHaven offers free world clocks, countdown timers, alarms, stopwatches, Pomodoro, weather, and currency tools. Boost your productivity with TimerHaven!">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google AdSense Auto Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0467059729557007"
     crossorigin="anonymous"></script>
    <style>
        body { font-family: 'Montserrat', Arial, sans-serif; background: linear-gradient(135deg, #f8fafc 0%, #e6f0ff 100%); color: #222; }
        .navbar { background: #1558b0; }
        .navbar-brand { font-family: 'Montserrat', Arial, sans-serif; font-weight: 700; font-size: 2rem; letter-spacing: 1px; display: flex; align-items: center; }
        .logo-svg { width: 40px; height: 40px; margin-right: 10px; }
        .hero-section { background: linear-gradient(135deg, #1558b0 70%, #26c6da 100%); color: #fff; text-align: center; padding: 60px 10px 30px 10px; border-radius: 0 0 35% 35%/10%; margin-bottom: 2rem; }
        .hero-section h1 { font-weight: 700; letter-spacing: 1px; font-size: 2.7rem; }
        .hero-section p { font-size: 1.2rem; margin-bottom: 30px; }
        .hero-clock { font-size: 2.1rem; font-weight: 700; letter-spacing: 1px; margin: 24px 0 6px 0; text-shadow: 0 2px 8px #0002; }
        .tools-section { margin-top: 1rem; }
        .tool-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 14px rgba(21,88,176,0.07); padding: 30px 20px 20px 20px; margin-bottom: 30px; transition: transform 0.13s; }
        .tool-card:hover { transform: translateY(-4px) scale(1.015); box-shadow: 0 8px 32px rgba(38,198,218,0.11); }
        .card-title { font-weight: 700; }
        .social-share { margin: 20px 0 0 0; text-align: center; }
        .social-share a { margin: 0 12px; font-size: 2.1rem; color: #fff; text-decoration: none; transition: color 0.2s, transform 0.1s; opacity: 1; filter: drop-shadow(0 1px 2px #1558b0); }
        .social-share a:hover { color: #ff9800; transform: scale(1.20); }
        .adsense { margin: 36px 0 32px 0; text-align: center; }
        .affiliate-section { background: #f1f9ff; border-radius: 12px; padding: 25px 18px 10px 18px; margin-bottom: 35px; box-shadow: 0 2px 10px rgba(21, 88, 176, 0.05); }
        .affiliate-section h3 { font-size: 1.3rem; margin-bottom: 14px; color: #1558b0; }
        .weather-dark { color: #1a1a1a !important; background: none !important; }
        .currency-error { color: #c00 !important; font-weight: bold; }
        .currency-retry { margin-top: 6px; }
        .currency-select, .currency-select option { color: #222 !important; }
        .btn-timer { min-width: 80px; }
        /* Alarm Modal Styles */
        .modal-backdrop.show { opacity: 0.35; }
        .modal-content { border-radius: 12px; }
        .alarm-modal-label { font-weight: 600; }
        .alarm-modal-arrow-btn { border: none; background: #e6f0ff; border-radius: 4px; width: 32px; height: 32px; font-size: 1.4em; }
        .alarm-modal-arrow-btn:active { background: #b9d6f5; }
        .alarm-modal-time-row { display: flex; align-items: flex-end; gap: 24px; margin-bottom: 1rem; justify-content: center; }
        .alarm-modal-time-group { display: flex; flex-direction: column; align-items: center; gap: 2px; min-width: 110px; }
        .alarm-modal-time-group select { min-width: 70px; }
        .alarm-modal-title-input { width: 100%; }
        .alarm-modal-sound-group { display: flex; align-items: center; gap: 8px; justify-content: center; }
        /* Center alarm message and modal button row */
        #alarm-message { text-align: center; }
        @media (max-width: 991px) { .hero-section { border-radius: 0 0 19% 19%/10%; } }
        @media (max-width: 767px) { .tool-card { padding: 18px 8px 18px 8px; } .affiliate-section { padding: 18px 8px 10px 8px; } }
    </style>
	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R1F6Y45MW2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-R1F6Y45MW2');
</script>
<!-- Osano Cookie Consent Banner -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    palette: {
      popup: { background: "#1558b0" },
      button: { background: "#ff9800" }
    },
    theme: "classic",
    position: "bottom-right",
    content: {
      message: "This website uses cookies to ensure you get the best experience.",
      dismiss: "Got it!",
      link: "Learn more",
      href: "/privacy-policy"
    }
  });
});
</script>
</head>
<body>
    <!-- NAVIGATION BAR -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="#">
            <svg class="logo-svg" viewBox="0 0 64 64" fill="none"><circle cx="32" cy="32" r="29" fill="#26c6da" stroke="#fff" stroke-width="5"/><path d="M32 14V32L44 38" stroke="#fff" stroke-width="5" stroke-linecap="round"/><circle cx="32" cy="32" r="7" fill="#ff9800"/></svg>
            TimerHaven
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="#tools">Tools</a></li>
            <li class="nav-item"><a class="nav-link" href="#resources">Resources</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- HERO SECTION -->
    <section class="hero-section">
        <div class="container">
            <h1>Master Your Time with TimerHaven</h1>
            <p>
                Free online world clocks, timers, alarms, weather, and currency tools.<br>
                The simple, powerful hub for time management!
            </p>
            <div id="hero-clock" class="hero-clock"></div>
            <div class="social-share">
                <a href="https://twitter.com/intent/tweet?url=https://www.timerhaven.com/&text=TimerHaven%20-%20Free%20online%20timers,%20clocks%20and%20productivity%20tools!" target="_blank" title="Share on Twitter"><i class="fab fa-twitter"></i></a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.timerhaven.com/" target="_blank" title="Share on Facebook"><i class="fab fa-facebook"></i></a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.timerhaven.com/" target="_blank" title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="mailto:?subject=TimerHaven%20Web%20Tools&body=Check%20out%20https://www.timerhaven.com%20for%20clocks,%20timers,%20weather,%20and%20currency%20conversion!" target="_blank" title="Share via Email"><i class="fa fa-envelope"></i></a>
            </div>
        </div>
    </section>
    <div class="adsense"></div>
    <section class="container tools-section" id="tools">
        <div class="row row-cols-1 row-cols-lg-3 g-4">
            <!-- World Clock -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-globe"></i> World Clock</h3>
                    <p>Select any city and see its current time in real-time.</p>
                    <select id="city-select" class="form-select mb-2"></select>
                    <div id="world-clock-time" class="fs-4 fw-bold mt-2 mb-1"></div>
                </div>
            </div>
            <!-- Countdown Timer -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-hourglass-start"></i> Countdown Timer</h3>
                    <p>Set a custom countdown and stay on track!</p>
                    <input type="number" id="cd-mins" class="form-control mb-2" placeholder="Minutes" min="0" max="999">
                    <input type="number" id="cd-secs" class="form-control mb-2" placeholder="Seconds" min="0" max="59">
                    <div class="btn-group w-100 mb-2">
                        <button id="btn-countdown-start" class="btn btn-primary btn-timer" onclick="startCountdown()">Start</button>
                        <button id="btn-countdown-pause" class="btn btn-secondary btn-timer" onclick="pauseCountdown()">Pause</button>
                        <button id="btn-countdown-reset" class="btn btn-danger btn-timer" onclick="resetCountdown()">Reset</button>
                    </div>
                    <div id="countdown-display" class="fs-5 fw-bold"></div>
                </div>
            </div>
            <!-- Alarm -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-bell"></i> Alarm</h3>
                    <p>Set an alarm for any time, with sound, title, and repeat.</p>
                    <div class="d-flex justify-content-center mb-2">
                        <button class="btn btn-sm btn-primary me-2" onclick="openAlarmModal()">Set Alarm</button>
                        <button class="btn btn-sm btn-danger" onclick="resetAlarm()" id="cancel-alarm-btn" style="display:none;">Cancel Alarm</button>
                    </div>
                    <div id="alarm-message" class="fw-medium text-center"></div>
                </div>
            </div>
            <!-- Stopwatch -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-stopwatch"></i> Stopwatch</h3>
                    <p>Track elapsed time. Use for exercise, cooking, and more!</p>
                    <div id="stopwatch-display" class="fs-4 fw-bold mb-2">00:00:00</div>
                    <div class="btn-group w-100 mb-2">
                        <button class="btn btn-warning" onclick="startStopwatch()">Start</button>
                        <button class="btn btn-secondary" onclick="stopStopwatch()">Stop</button>
                        <button class="btn btn-danger" onclick="resetStopwatch()">Reset</button>
                    </div>
                    <ul id="lap-list" class="list-unstyled small"></ul>
                    <button class="btn btn-outline-primary w-100" onclick="lapStopwatch()">Lap</button>
                </div>
            </div>
            <!-- Pomodoro Timer -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-clock"></i> Pomodoro Timer</h3>
                    <p>Work in focused bursts with breaks. Boost productivity!</p>
                    <div id="pomodoro-display" class="fs-4 fw-bold mb-2">25:00</div>
                    <div class="btn-group w-100 mb-2">
                        <button class="btn btn-success" onclick="startPomodoro()">Start</button>
                        <button class="btn btn-secondary" onclick="pausePomodoro()">Pause</button>
                        <button class="btn btn-danger" onclick="resetPomodoro()">Reset</button>
                    </div>
                    <div id="pomodoro-status" class="small mt-1"></div>
                </div>
            </div>
            <!-- Weather -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-cloud-sun"></i> Weather</h3>
                    <p>Check current weather anywhere in the world.</p>
                    <input type="text" id="weather-city" class="form-control mb-2" placeholder="Enter city (e.g. London)">
                    <button class="btn btn-info w-100 mb-2" onclick="fetchWeather()">Get Weather</button>
                    <div id="weather-result" class="weather-dark small"></div>
                </div>
            </div>
            <!-- Currency Converter -->
            <div class="col">
                <div class="tool-card">
                    <h3 class="card-title"><i class="fa fa-coins"></i> Currency Converter</h3>
                    <p>Convert between currencies with live rates.</p>
                    <input type="number" id="currency-amount" class="form-control mb-2" placeholder="Amount" min="0">
                    <select id="currency-from" class="form-select mb-2 currency-select"></select>
                    <select id="currency-to" class="form-select mb-2 currency-select"></select>
                    <button class="btn btn-primary w-100 mb-2" onclick="convertCurrency()">Convert</button>
                    <div id="currency-result" class="fw-bold"></div>
                    <button id="retry-currencies" class="btn btn-sm btn-warning w-100 currency-retry" style="display:none;" onclick="loadCurrencies(true)">Retry Loading Currencies</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Alarm Modal (centered and improved) -->
    <div class="modal fade" id="alarmModal" tabindex="-1" aria-labelledby="alarmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
          <div class="modal-header">
            <h5 class="modal-title" id="alarmModalLabel"><i class="fa fa-bell"></i> Set Alarm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column align-items-center justify-content-center">
              <!-- Date Picker Row (NEW) -->
              <div class="mb-3 w-100 d-flex flex-column align-items-center">
                <label class="alarm-modal-label mb-1 text-center w-100">Date</label>
                <input type="date" id="modal-alarm-date" class="form-control" style="max-width: 200px;">
              </div>
              <!-- Centered Time Row -->
              <div class="alarm-modal-time-row mb-3" style="width:100%; justify-content:center;">
                <div class="alarm-modal-time-group mx-2">
                    <label class="alarm-modal-label mb-1 text-center w-100">Hours</label>
                    <div class="d-flex align-items-center">
                        <button class="alarm-modal-arrow-btn" onclick="alarmHourDown()">&#8592;</button>
                        <select id="modal-alarm-hour" class="form-select mx-1" style="width:75px;"></select>
                        <select id="modal-alarm-ampm" class="form-select mx-1" style="width:75px;"></select>
                        <button class="alarm-modal-arrow-btn" onclick="alarmHourUp()">&#8594;</button>
                    </div>
                </div>
                <div class="alarm-modal-time-group mx-2">
                    <label class="alarm-modal-label mb-1 text-center w-100">Minutes</label>
                    <div class="d-flex align-items-center">
                        <button class="alarm-modal-arrow-btn" onclick="alarmMinuteDown()">&#8592;</button>
                        <select id="modal-alarm-minute" class="form-select mx-1" style="width:75px;"></select>
                        <button class="alarm-modal-arrow-btn" onclick="alarmMinuteUp()">&#8594;</button>
                    </div>
                </div>
              </div>
              <!-- Sound and Repeat -->
              <div class="alarm-modal-sound-group mb-2 w-100 justify-content-center">
                  <label class="alarm-modal-label me-2">Sound</label>
                  <select id="modal-alarm-sound" class="form-select" style="width:auto;">
                      <option value="beep">Beep</option>
                      <option value="bells">Bells</option>
                      <option value="digital">Digital</option>
                  </select>
                  <button class="btn btn-outline-secondary btn-sm ms-2" type="button" onclick="testAlarmSound()"><i class="fa fa-play"></i> Test sound</button>
                  <div class="form-check ms-3">
                    <input class="form-check-input" type="checkbox" value="" id="modal-alarm-repeat" checked>
                    <label class="form-check-label" for="modal-alarm-repeat">Repeat Alarm</label>
                  </div>
              </div>
              <!-- Alarm Title -->
              <div class="mb-2 w-100">
                  <label class="alarm-modal-label mb-1">Alarm Title</label>
                  <input type="text" class="form-control alarm-modal-title-input" id="modal-alarm-title" maxlength="32" placeholder="Alarm">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal" onclick="cancelAlarmModal()">Cancel</button>
            <button class="btn btn-success" onclick="saveAlarmModal()">Start</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END Alarm Modal -->

    <section class="container affiliate-section" id="resources">
        <h3><i class="fa fa-star"></i> Recommended Productivity Tools</h3>
        <ul>
            <li>
                <a href="https://www.amazon.com/dp/B07X5F8X5N?tag=sergenet20-20" target="_blank" rel="nofollow sponsored">
                    Time Timer MOD Visual Timer
                </a> – The best visual countdown timer for work, school, and home.
            </li>
            <li>
                <a href="https://www.amazon.com/dp/1444794802?tag=sergenet20-20" target="_blank" rel="nofollow sponsored">
                    <i>Deep Work</i> by Cal Newport
                </a> – The classic book on focus and productivity.
            </li>
            <li>
                <a href="https://www.amazon.com/dp/B09JQ9YJBW?tag=sergenet20-20" target="_blank" rel="nofollow sponsored">
                    Moleskine Classic Planner
                </a> – Organize your life with this legendary paper planner.
            </li>
            <li>
                <a href="https://www.amazon.com/dp/B07GJNKQ8P?tag=sergenet20-20" target="_blank" rel="nofollow sponsored">
                    Logitech K380 Wireless Keyboard
                </a> – Write anywhere, stay productive!
            </li>
        </ul>
        <p class="small mt-3">As an Amazon Associate, TimerHaven earns from qualifying purchases. Thanks for your support!</p>
    </section>
    <footer>
        <div class="footer-links">
            <a href="#tools">Tools</a> |
            <a href="#resources">Resources</a> |
            <a href="mailto:contact@timerhaven.com">Contact</a>
        </div>
        <div>
            &copy; 2025 TimerHaven. All Rights Reserved.
        </div>
        <div class="small">
            Built by <a href="https://github.com/sergenet" target="_blank">sergenet</a> | 
            <a href="https://www.amazon.com/?tag=sergenet20-20" target="_blank" rel="nofollow sponsored">Amazon Partner</a>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // HERO LIVE CLOCK
        function updateHeroClock() {
            const now = new Date();
            const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
            const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
            const d = days[now.getDay()];
            const month = months[now.getMonth()];
            const dateStr = `${d}, ${month} ${now.getDate()}, ${now.getFullYear()} • ` +
                now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            document.getElementById('hero-clock').textContent = dateStr;
        }
        setInterval(updateHeroClock, 1000); updateHeroClock();

        // WORLD CLOCK (12-hour format with AM/PM)
        const cities = [
            { name: "Auckland, New Zealand", tz: "Pacific/Auckland" },
            { name: "Athens, Greece", tz: "Europe/Athens" },
            { name: "Bangkok, Thailand", tz: "Asia/Bangkok" },
            { name: "Beijing, China", tz: "Asia/Shanghai" },
            { name: "Berlin, Germany", tz: "Europe/Berlin" },
            { name: "Buenos Aires, Argentina", tz: "America/Buenos_Aires" },
            { name: "Cairo, Egypt", tz: "Africa/Cairo" },
            { name: "Chicago, USA", tz: "America/Chicago" },
            { name: "Dallas, USA", tz: "America/Chicago" },
            { name: "Delhi, India", tz: "Asia/Kolkata" },
            { name: "Denver, USA", tz: "America/Denver" },
            { name: "Dubai, UAE", tz: "Asia/Dubai" },
            { name: "Hong Kong, China", tz: "Asia/Hong_Kong" },
            { name: "Istanbul, Turkey", tz: "Europe/Istanbul" },
            { name: "Jerusalem, Israel", tz: "Asia/Jerusalem" },
            { name: "Johannesburg, South Africa", tz: "Africa/Johannesburg" },
            { name: "Lagos, Nigeria", tz: "Africa/Lagos" },
            { name: "London, UK", tz: "Europe/London" },
            { name: "Los Angeles, USA", tz: "America/Los_Angeles" },
            { name: "Madrid, Spain", tz: "Europe/Madrid" },
            { name: "Mexico City, Mexico", tz: "America/Mexico_City" },
            { name: "Moscow, Russia", tz: "Europe/Moscow" },
            { name: "Mumbai, India", tz: "Asia/Kolkata" },
            { name: "New York, USA", tz: "America/New_York" },
            { name: "Paris, France", tz: "Europe/Paris" },
            { name: "Rome, Italy", tz: "Europe/Rome" },
            { name: "São Paulo, Brazil", tz: "America/Sao_Paulo" },
            { name: "Seoul, South Korea", tz: "Asia/Seoul" },
            { name: "Shanghai, China", tz: "Asia/Shanghai" },
            { name: "Singapore", tz: "Asia/Singapore" },
            { name: "Sydney, Australia", tz: "Australia/Sydney" },
            { name: "Tokyo, Japan", tz: "Asia/Tokyo" },
            { name: "Toronto, Canada", tz: "America/Toronto" },
            { name: "UTC (Coordinated Universal Time)", tz: "UTC" },
            { name: "Vancouver, Canada", tz: "America/Vancouver" },
            { name: "Warsaw, Poland", tz: "Europe/Warsaw" }
        ].sort((a, b) => a.name.localeCompare(b.name));
        function populateWorldClockDropdown() {
            const sel = document.getElementById('city-select');
            sel.innerHTML = '';
            cities.forEach(city => {
                const opt = document.createElement('option');
                opt.value = city.tz;
                opt.textContent = city.name;
                sel.appendChild(opt);
            });
        }
        populateWorldClockDropdown();
        const DateTime = luxon.DateTime;
        function updateWorldClock() {
            const sel = document.getElementById('city-select');
            const city = sel.value;
            const now = city === 'UTC' ? DateTime.utc() : DateTime.now().setZone(city);
            // 12-hour format with AM/PM
            document.getElementById('world-clock-time').textContent =
              now.toFormat('cccc, dd LLL yyyy • hh:mm:ss a');
        }
        document.getElementById('city-select').addEventListener('change', updateWorldClock);
        setInterval(updateWorldClock, 1000);
        updateWorldClock();

        // COUNTDOWN TIMER
        let cdInterval = null;
        let cdPaused = false;
        let cdTotal = 0;
        window.startCountdown = function() {
            if (cdInterval) clearInterval(cdInterval);
            const mins = parseInt(document.getElementById('cd-mins').value) || 0;
            const secs = parseInt(document.getElementById('cd-secs').value) || 0;
            cdTotal = mins * 60 + secs;
            cdPaused = false;
            if (cdTotal <= 0) {
                document.getElementById('countdown-display').textContent = "Enter a valid time!";
                return;
            }
            updateCountdownDisplay();
            cdInterval = setInterval(tickCountdown, 1000);
        };
        function tickCountdown() {
            if (cdPaused) return;
            if (cdTotal <= 0) {
                clearInterval(cdInterval);
                document.getElementById('countdown-display').textContent = "⏰ Time's up!";
                playBuzzer();
                return;
            }
            cdTotal--;
            updateCountdownDisplay();
            if (cdTotal <= 0) {
                clearInterval(cdInterval);
                document.getElementById('countdown-display').textContent = "⏰ Time's up!";
                playBuzzer();
            }
        }
        window.pauseCountdown = function() {
            cdPaused = !cdPaused;
            document.getElementById('btn-countdown-pause').textContent = cdPaused ? "Resume" : "Pause";
        };
        window.resetCountdown = function() {
            clearInterval(cdInterval);
            cdInterval = null;
            cdPaused = false;
            cdTotal = 0;
            document.getElementById('cd-mins').value = '';
            document.getElementById('cd-secs').value = '';
            document.getElementById('countdown-display').textContent = '';
            document.getElementById('btn-countdown-pause').textContent = "Pause";
        };
        function updateCountdownDisplay() {
            let m = Math.floor(cdTotal / 60);
            let s = cdTotal % 60;
            document.getElementById('countdown-display').textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // BUZZER sound for countdown timer
        function playBuzzer() {
            let url = 'https://actions.google.com/sounds/v1/alarms/buzzer.ogg';
            let audio = new window.Audio(url);
            audio.currentTime = 0;
            document.body.appendChild(audio);
            audio.play().finally(() => {
                setTimeout(() => { if (audio.parentNode) audio.parentNode.removeChild(audio); }, 3500);
            });
        }

        // ALARM (with fixed sound test urls)
        let alarmTimeout = null, alarmRepeat = null, alarmActive = false;
        let alarmConfig = {
            hour: 7, minute: 0, ampm: "AM",
            sound: "beep", repeat: true,
            title: "",
            date: null // NEW: Store selected date
        };
        function playAlarmSound(type, allowFallback) {
            let url = null;
            if (type === 'bells') {
                url = 'https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg';
            } else if (type === 'digital') {
                url = 'https://actions.google.com/sounds/v1/alarms/beep_short.ogg';
            }
            if (url) {
                let audio = new window.Audio(url);
                audio.currentTime = 0;
                document.body.appendChild(audio);
                audio.play().catch(() => {
                    if (allowFallback) fallbackBeep();
                }).finally(() => {
                    setTimeout(() => { if (audio.parentNode) audio.parentNode.removeChild(audio); }, 3000);
                });
            } else {
                fallbackBeep();
            }
            function fallbackBeep() {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const o = ctx.createOscillator();
                    o.type = 'sine'; o.frequency.value = 880;
                    o.connect(ctx.destination); o.start();
                    setTimeout(()=>{o.stop();ctx.close();}, 350);
                } catch {}
            }
        }
        function openAlarmModal() {
            // Populate hour/minute/ampm dropdowns
            const hourSel = document.getElementById('modal-alarm-hour');
            const minSel = document.getElementById('modal-alarm-minute');
            const ampmSel = document.getElementById('modal-alarm-ampm');
            const dateInput = document.getElementById('modal-alarm-date');
            hourSel.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                let opt = document.createElement('option');
                opt.value = i;
                opt.textContent = i.toString().padStart(2, '0');
                hourSel.appendChild(opt);
            }
            minSel.innerHTML = '';
            for (let i = 0; i < 60; i++) {
                let opt = document.createElement('option');
                opt.value = i;
                opt.textContent = i.toString().padStart(2, '0');
                minSel.appendChild(opt);
            }
            ampmSel.innerHTML = '';
            ["AM", "PM"].forEach(a => {
                let opt = document.createElement('option');
                opt.value = a;
                opt.textContent = a;
                ampmSel.appendChild(opt);
            });
            // Set current config values
            hourSel.value = alarmConfig.hour;
            minSel.value = alarmConfig.minute;
            ampmSel.value = alarmConfig.ampm;
            document.getElementById('modal-alarm-sound').value = alarmConfig.sound;
            document.getElementById('modal-alarm-repeat').checked = alarmConfig.repeat;
            document.getElementById('modal-alarm-title').value = alarmConfig.title;

            // Set the date picker to today or the selected date
            let todayStr = new Date().toISOString().split("T")[0];
            if (alarmConfig.date) {
                dateInput.value = alarmConfig.date;
            } else {
                dateInput.value = todayStr;
            }
            // Show modal
            var modal = new bootstrap.Modal(document.getElementById('alarmModal'));
            modal.show();
        }
        function alarmHourUp() {
            let sel = document.getElementById('modal-alarm-hour');
            let val = parseInt(sel.value, 10);
            sel.value = val === 12 ? 1 : val + 1;
        }
        function alarmHourDown() {
            let sel = document.getElementById('modal-alarm-hour');
            let val = parseInt(sel.value, 10);
            sel.value = val === 1 ? 12 : val - 1;
        }
        function alarmMinuteUp() {
            let sel = document.getElementById('modal-alarm-minute');
            let val = parseInt(sel.value, 10);
            sel.value = (val + 1) % 60;
        }
        function alarmMinuteDown() {
            let sel = document.getElementById('modal-alarm-minute');
            let val = parseInt(sel.value, 10);
            sel.value = (val - 1 + 60) % 60;
        }
        function testAlarmSound() {
            playAlarmSound(document.getElementById('modal-alarm-sound').value, false);
        }
        function saveAlarmModal() {
            alarmConfig.hour = parseInt(document.getElementById('modal-alarm-hour').value, 10);
            alarmConfig.minute = parseInt(document.getElementById('modal-alarm-minute').value, 10);
            alarmConfig.ampm = document.getElementById('modal-alarm-ampm').value;
            alarmConfig.sound = document.getElementById('modal-alarm-sound').value;
            alarmConfig.repeat = document.getElementById('modal-alarm-repeat').checked;
            alarmConfig.title = document.getElementById('modal-alarm-title').value || "Alarm";
            alarmConfig.date = document.getElementById('modal-alarm-date').value; // NEW: Save date
            var modalEl = document.getElementById('alarmModal');
            var modal = bootstrap.Modal.getInstance(modalEl);
            if (modal) modal.hide();
            setAlarmWithConfig();
        }
        function cancelAlarmModal() {
            // Only closes modal. Does not reset alarm (Cancel Alarm button outside does that)
        }
        function setAlarmWithConfig() {
            clearTimeout(alarmTimeout);
            if (alarmRepeat) clearInterval(alarmRepeat);
            alarmActive = false;
            // Calculate next alarm time using date + time
            let hr = alarmConfig.hour % 12;
            if (alarmConfig.ampm === "PM") hr += 12;
            const now = new Date();
            // If alarmConfig.date is not set, fallback to today
            let targetDateStr = alarmConfig.date || new Date().toISOString().split("T")[0];
            let [year, month, day] = targetDateStr.split("-").map(Number);
            // month in JS Date is 0-based
            let target = new Date(year, month - 1, day, hr, alarmConfig.minute, 0, 0);
            // If the target time is in the past, show warning and don't set alarm
            if (target <= now) {
                document.getElementById("alarm-message").textContent = "Selected alarm time is in the past. Please choose a future date/time.";
                document.getElementById("cancel-alarm-btn").style.display = "none";
                return;
            }
            const delay = target - now;
            document.getElementById("alarm-message").textContent =
              `Alarm "${alarmConfig.title}" set for ${target.toLocaleString('en-US', {
                  month: 'short', day: 'numeric', year: 'numeric'
              })} at ${alarmConfig.hour.toString().padStart(2,'0')}:` +
              `${alarmConfig.minute.toString().padStart(2,'0')} ${alarmConfig.ampm}`;
            document.getElementById("cancel-alarm-btn").style.display = "";
            alarmTimeout = setTimeout(triggerAlarm, delay);
        }
        function triggerAlarm() {
    alarmActive = true;
    function playAndRepeat() {
        if (!alarmActive) return;
        playAlarmSound(alarmConfig.sound, true);
        document.getElementById("alarm-message").textContent = `🔔 ${alarmConfig.title} (ALARM!)`;
    }
    playAndRepeat();
    if (alarmConfig.repeat) {
        alarmRepeat = setInterval(playAndRepeat, 3500);
    } else {
        // No repeat: after the alert, reset everything
        setTimeout(() => {
            alert(`⏰ ${alarmConfig.title}!\nTime's up!`);
            resetAlarm();
        }, 100);
    }
    if (alarmConfig.repeat) {
        // For repeat, still show alert but do not reset immediately
        setTimeout(() => {
            alert(`⏰ ${alarmConfig.title}!\nTime's up!`);
        }, 100);
    }
}
        function resetAlarm() {
            clearTimeout(alarmTimeout);
            if (alarmRepeat) clearInterval(alarmRepeat);
            alarmActive = false;
            document.getElementById("alarm-message").textContent = '';
            document.getElementById("cancel-alarm-btn").style.display = "none";
            // Reset alarm config to defaults
            alarmConfig = { hour: 7, minute: 0, ampm: "AM", sound: "beep", repeat: true, title: "", date: null };
            // If modal is open, clear modal fields as well
            let hourSel = document.getElementById('modal-alarm-hour');
            let minSel = document.getElementById('modal-alarm-minute');
            let ampmSel = document.getElementById('modal-alarm-ampm');
            let titleInput = document.getElementById('modal-alarm-title');
            let soundSel = document.getElementById('modal-alarm-sound');
            let repeatBox = document.getElementById('modal-alarm-repeat');
            let dateInput = document.getElementById('modal-alarm-date');
            if (hourSel && minSel && ampmSel && titleInput && soundSel && repeatBox && dateInput) {
                hourSel.value = "7";
                minSel.value = "0";
                ampmSel.value = "AM";
                soundSel.value = "beep";
                repeatBox.checked = true;
                titleInput.value = "";
                // Reset date to today
                dateInput.value = new Date().toISOString().split("T")[0];
            }
        }
        window.openAlarmModal = openAlarmModal;
        window.alarmHourUp = alarmHourUp;
        window.alarmHourDown = alarmHourDown;
        window.alarmMinuteUp = alarmMinuteUp;
        window.alarmMinuteDown = alarmMinuteDown;
        window.testAlarmSound = testAlarmSound;
        window.saveAlarmModal = saveAlarmModal;
        window.cancelAlarmModal = cancelAlarmModal;
        window.resetAlarm = resetAlarm;

        // STOPWATCH
        let swInterval, swStart, swElapsed = 0, swRunning = false, lapNum = 1;
        function formatSW(ms) {
            let sec = Math.floor(ms/1000)%60, min = Math.floor(ms/60000)%60, hr = Math.floor(ms/3600000);
            return `${hr.toString().padStart(2,"0")}:${min.toString().padStart(2,"0")}:${sec.toString().padStart(2,"0")}`;
        }
        function updateStopwatch() {
            let now = Date.now();
            let elapsed = swElapsed + (swRunning ? (now - swStart) : 0);
            document.getElementById('stopwatch-display').textContent = formatSW(elapsed);
        }
        window.startStopwatch = function() {
            if (swRunning) return;
            swRunning = true;
            swStart = Date.now();
            swInterval = setInterval(updateStopwatch, 200);
        };
        window.stopStopwatch = function() {
            if (!swRunning) return;
            swElapsed += Date.now() - swStart;
            swRunning = false;
            clearInterval(swInterval);
            updateStopwatch();
        };
        window.resetStopwatch = function() {
            window.stopStopwatch();
            swElapsed = 0;
            lapNum = 1;
            document.getElementById('stopwatch-display').textContent = "00:00:00";
            document.getElementById('lap-list').innerHTML = '';
        };
        window.lapStopwatch = function() {
            let now = Date.now();
            let elapsed = swElapsed + (swRunning ? (now - swStart) : 0);
            let lapTime = formatSW(elapsed);
            let lapItem = document.createElement('li');
            lapItem.textContent = `Lap ${lapNum++}: ${lapTime}`;
            document.getElementById('lap-list').prepend(lapItem);
        };

        // POMODORO TIMER
        let pomodoroInterval, pomodoroSeconds = 1500, isBreak = false, pomodoroRunning = false;
        function updatePomodoroDisplay() {
            let m = Math.floor(pomodoroSeconds/60);
            let s = pomodoroSeconds%60;
            document.getElementById('pomodoro-display').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }
        window.startPomodoro = function() {
            if (pomodoroRunning) return;
            pomodoroRunning = true;
            document.getElementById('pomodoro-status').textContent = isBreak ? "Break time! 🎉" : "Focus time! 💪";
            pomodoroInterval = setInterval(() => {
                if (pomodoroSeconds <= 0) {
                    clearInterval(pomodoroInterval);
                    pomodoroRunning = false;
                    playBeep();
                    isBreak = !isBreak;
                    pomodoroSeconds = isBreak ? 300 : 1500; // 5 min break or 25 min focus
                    document.getElementById('pomodoro-status').textContent = isBreak ? "Break started!" : "Back to work!";
                    window.startPomodoro();
                } else {
                    pomodoroSeconds--;
                    updatePomodoroDisplay();
                }
            }, 1000);
        };
        window.pausePomodoro = function() {
            clearInterval(pomodoroInterval);
            pomodoroRunning = false;
            document.getElementById('pomodoro-status').textContent = "Paused";
        };
        window.resetPomodoro = function() {
            window.pausePomodoro();
            pomodoroSeconds = 1500;
            isBreak = false;
            updatePomodoroDisplay();
            document.getElementById('pomodoro-status').textContent = "";
        };
        updatePomodoroDisplay();

        // WEATHER
        const WEATHER_API_KEY = '63cbee1756fd4002802201248250109';
        window.fetchWeather = async function() {
            const city = document.getElementById('weather-city').value.trim();
            if (!city) {
                document.getElementById('weather-result').textContent = "Enter a city name!";
                return;
            }
            document.getElementById('weather-result').textContent = "Loading...";
            try {
                const url = `https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city)}`;
                const res = await fetch(url);
                if (!res.ok) throw new Error("City not found");
                const data = await res.json();
                document.getElementById('weather-result').innerHTML =
                    `<b>${data.location.name}, ${data.location.country}</b>: ${data.current.condition.text}<br>
                     <b>Temp:</b> ${data.current.temp_c}°C (${data.current.temp_f}°F) | <b>Humidity:</b> ${data.current.humidity}%<br>
                     <img src="https:${data.current.condition.icon}" alt="icon" style="height:38px;vertical-align:middle;">`;
            } catch (e) {
                document.getElementById('weather-result').textContent = "Could not fetch weather.";
            }
        };

        // CURRENCY CONVERTER
        let currencyList = [];
        window.loadCurrencies = async function(force) {
            const fromSel = document.getElementById('currency-from');
            const toSel = document.getElementById('currency-to');
            const retryBtn = document.getElementById('retry-currencies');
            fromSel.innerHTML = toSel.innerHTML = '<option>Loading...</option>';
            retryBtn.style.display = "none";
            try {
                const res = await fetch('currency-proxy.php');
                if (!res.ok) throw new Error("Network error");
                const data = await res.json();
                if (data.supported_codes) {
                    currencyList = data.supported_codes.map(([code]) => code);
                    fromSel.innerHTML = toSel.innerHTML = '';
                    data.supported_codes.forEach(([code, name]) => {
                        let opt1 = document.createElement('option');
                        let opt2 = document.createElement('option');
                        opt1.value = opt2.value = code;
                        opt1.textContent = opt2.textContent = `${code} - ${name}`;
                        fromSel.appendChild(opt1);
                        toSel.appendChild(opt2);
                    });
                    fromSel.value = 'USD';
                    toSel.value = 'EUR';
                    document.getElementById('currency-result').textContent = "";
                    document.getElementById('currency-result').classList.remove('currency-error');
                } else {
                    throw new Error("Invalid API response");
                }
            } catch (e) {
                fromSel.innerHTML = toSel.innerHTML = '';
                const failOpt = document.createElement('option');
                failOpt.textContent = "Failed to load currencies";
                fromSel.appendChild(failOpt);
                toSel.appendChild(failOpt.cloneNode(true));
                document.getElementById('currency-result').textContent = "Unable to load currencies. Please check your internet connection and try again.";
                document.getElementById('currency-result').classList.add('currency-error');
                retryBtn.style.display = "";
            }
        };
        window.convertCurrency = async function() {
            const amount = parseFloat(document.getElementById('currency-amount').value);
            const from = document.getElementById('currency-from').value;
            const to = document.getElementById('currency-to').value;
            if (isNaN(amount) || amount <= 0) {
                document.getElementById('currency-result').textContent = "Enter a valid amount.";
                document.getElementById('currency-result').classList.add('currency-error');
                return;
            }
            document.getElementById('currency-result').classList.remove('currency-error');
            document.getElementById('currency-result').textContent = "Loading...";
            try {
                const url = `currency-proxy.php?convert=1&from=${from}&to=${to}&amount=${amount}`;
                const res = await fetch(url);
                const data = await res.json();
                if (data.success && typeof data.result === "number") {
                    document.getElementById('currency-result').textContent =
                        `${amount} ${from} ≈ ${data.result.toFixed(2)} ${to}`;
                } else {
                    document.getElementById('currency-result').textContent = "Conversion failed.";
                    document.getElementById('currency-result').classList.add('currency-error');
                }
            } catch (e) {
                document.getElementById('currency-result').textContent = "Conversion failed.";
                document.getElementById('currency-result').classList.add('currency-error');
            }
        };
        window.loadCurrencies();

        // UTILS
        window.playBeep = function() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const o = ctx.createOscillator();
                o.type = 'sine'; o.frequency.value = 880;
                o.connect(ctx.destination); o.start();
                setTimeout(()=>{o.stop();ctx.close();}, 300);
            } catch {}
        };
    });
    </script>
</body>
</html>